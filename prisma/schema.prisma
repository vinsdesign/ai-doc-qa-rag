generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Document {
  id        String    @id @default(cuid())
  title     String
  fileUrl   String
  status    DocStatus @default(UPLOADED)

  chunks    DocumentChunk[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([status])
  @@index([createdAt])
}

model DocumentChunk {
  id         String   @id @default(cuid())
  documentId String
  document   Document @relation(fields: [documentId], references: [id], onDelete: Cascade)

  page       Int?
  chunkIndex Int
  content    String

  createdAt  DateTime @default(now())

  @@index([documentId])
  @@unique([documentId, chunkIndex])
}

enum DocStatus {
  UPLOADED
  INDEXING
  INDEXED
  FAILED
}